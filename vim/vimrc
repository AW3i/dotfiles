let vimpath = '$HOME/.vim/'
if has('nvim')
    let vimpath = '$HOME/.config/nvim/'
endif

" Auto Installs vim-plugged if it doesn't exist
if empty(glob(vimpath . 'autoload/plug.vim'))
    exec 'silent' '!' 'curl -fLo' . vimpath . 'autoload/plug.vim --create-dirs  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
    silent !curl -fLo vimpath . 'autoload/plug.vim' --create-dirs
    autocmd VimEnter * PlugInstall
endif
set pumblend=20
set backspace=indent,eol,start
set history=1000
set showcmd
set incsearch
set hlsearch
set wrap
set linebreak
set laststatus=2

set tabstop=4
set expandtab
set smarttab
set shiftwidth=4
set shiftround
set matchpairs+=<:>

set scrolloff=10
set sidescrolloff=7
set sidescroll=1

syntax on
set showmatch
set hidden
set noautowrite
set more
set noshowmode
set nostartofline
set wildmenu
set lazyredraw
set shell=zsh
" set number
" set relativenumber
set iskeyword+=_,$,@,%,#
set splitbelow
set splitright
set undolevels=500
if has("persistent_undo")
    set undofile
endif
set timeout timeoutlen=1000 ttimeoutlen=100
set list listchars=tab:»·,trail:·,extends:»,precedes:«
set encoding=utf-8
scriptencoding utf-8
set complete+=i,kspell
" set spellang=en_gb,de_de
set omnifunc=syntaxcomplete#Complete
set wildignore+=*.bmp,*.gif,*.jpg,*.png,*.ico
set wildignore+=*.swp,*.tmp
if executable('rg')
    set grepprg=rg\ --vimgrep\ --no-ignore\ --no-heading\ --smart-case
endif

let &showbreak='↪ '
let mapleader = " "
let maplocalleader = "\\"
set title
set noequalalways
if exists('&inccommand')
  set inccommand=split
endif
set foldmethod=syntax
set foldlevel=1
autocmd FileType php setlocal foldmethod=expr
set viewoptions=cursor,folds,slash,unix
set conceallevel=2

set nomodeline
set tags=tags

filetype plugin indent  on
filetype off

highlight! ErrorSign guifg=black guibg=#E01600 ctermfg=16 ctermbg=160
highlight! WarningSign guifg=black guibg=#FFED26 ctermfg=16 ctermbg=11

" Use a blinking upright bar cursor in Insert mode, a solid block in normal
" and a blinking underline in replace mode
set guicursor=n-v-c:block-Cursor/lCursor-blinkon0,i-ci:ver25-Cursor/lCursor,r-cr:hor20-Cursor/lCursor
"enable mouse support
set mouse=a

call plug#begin(vimpath. 'plugged')
" Plug 'Raimondi/delimitMate'
"     let delimitMate_jump_expansion = 1
"     let delimitMate_expand_cr = 2
"     let delimitMate_expand_space = 0
Plug 'tmsvg/pear-tree'
    " let g:pear_tree_pairs = {
    "   \ '<*>': { 'closer': '</*>',
    "   \          'not_if': ['br', 'hr', 'img', 'input', 'link', 'meta',
    "   \                  'area', 'base', 'col', 'command', 'embed',
    "   \                  'keygen', 'param', 'source', 'track', 'wbr'],
    "   \          'not_like': '{[^}]*$\|/$',
    "   \          'until': '[^a-zA-Z0-9-._]',
    "   \          'not_at': ['[^> ]<[^>]*'],
    "   \          'not_in': ['String']
    "   \        }
    "   \ }
Plug 'kana/vim-operator-replace'
Plug 'kana/vim-operator-user'
Plug 'tommcdo/vim-exchange'
Plug 'rhysd/vim-grammarous'
Plug 'mechatroner/rainbow_csv'
    autocmd BufNewFile,BufRead *.csv   set filetype=csv_semicolon
    augroup html_pairs
        autocmd!
        autocmd FileType html let b:pear_tree_pairs = {
                    \'<*>': {'closer': '</*>'}
                    \ }
    augroup END
    let g:pear_tree_ft_disabled = ['c', 'python', 'markdown']
Plug 'tommcdo/vim-lion'
Plug 'tpope/vim-surround'
Plug 'tpope/vim-repeat'
Plug 'tomtom/tcomment_vim'
Plug 'tpope/vim-abolish'
if has('python')
    Plug 'SirVer/UltiSnips' | Plug 'honza/vim-snippets'
        let g:UltiSnipsExpandTrigger = "<tab>"
        let g:UltiSnipsJumpForwardTrigger = "<tab>"
        let g:UltiSnipsJumpBackwardTrigger = "<s-tab>"
        let g:UltiSnipsUsePythonVersion = 3
        let g:UltiSnipsEditSplit="vertical"
        let g:UltiSnipsSnippetDirectories = ['~/.config/nvim/UltiSnips', 'UltiSnips']
        let g:snips_author = 'Alexandros Weigl'
        if !exists("g:snips_company")
            let g:snips_company = 'TechDivison'
        endif
        if !exists("g:snips_username")
            let g:snips_username = 'AW3i'
        endif
endif
" Readline bindings
Plug 'tpope/vim-rsi'
Plug 'wellle/targets.vim'
" Star search
Plug 'pgdouyon/vim-evanesco'
Plug 'mbbill/undotree', {'on': 'UndotreeToggle'}
Plug 'tpope/vim-unimpaired'
Plug 'tpope/vim-eunuch'
Plug 'dansomething/vim-hackernews', {'on': 'HackerNews'}
Plug 'neomake/neomake'
    let g:neomake_php_phpcs_args_standard = 'src/vendor/magento/magento-coding-standard/Magento2/ruleset.xml'
    let g:neomake_php_enabled_makers = ['php', 'phpcs', 'phpmd']
Plug 'rhysd/git-messenger.vim'
Plug 'justinmk/vim-sneak'
    let g:sneak#label = 1
Plug 'justinmk/vim-dirvish'
    augroup my_dirvish_events
      autocmd!
      " Map t to "open in new tab".
      autocmd FileType dirvish
        \  nnoremap <buffer> t :call dirvish#open('tabedit', 0)<CR>
        \ |xnoremap <buffer> t :call dirvish#open('tabedit', 0)<CR>

      " Enable :Gstatus and friends.
      autocmd FileType dirvish call FugitiveDetect(@%)

      " Map CTRL-R to reload the Dirvish buffer.
      autocmd FileType dirvish nnoremap <buffer> <C-R> :<C-U>Dirvish %<CR>

      " Map `gh` to hide dot-prefixed files.
      " To "toggle" this, just press `R` to reload.
      autocmd FileType dirvish nnoremap <buffer>
        \ gh :keeppatterns g@\v/\.[^\/]+/?$@d<cr>
    augroup END
Plug 'kassio/neoterm'
    let g:neoterm_default_mod = 'botright'
    let g:neoterm_automap_keys = '<leader>tm'
    let g:neoterm_use_relative_path = 1
    let g:neoterm_autoscroll = 1
    let g:neoterm_always_open_to_exec = 0
Plug 'ryanoasis/vim-devicons'
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plug 'junegunn/fzf.vim'
    command! -bang -nargs=? -complete=dir Files
        \ call fzf#vim#files(<q-args>, fzf#vim#with_preview({'options': ['--layout=reverse', '--info=inline']}), <bang>0)
    \ call fzf#vim#files(<q-args>, {'options': ['--layout=reverse', '--info=inline','--preview-window', 'down', '--preview', '~/.config/nvim/plugged/fzf.vim/bin/preview.sh {}']}, <bang>0)
    " command! -bang -nargs=* Rg
    "     \ call fzf#vim#grep('rg --no-heading --line-number '.shellescape(<q-args>),
    "     \ 1,
    "     \ fzf#vim#with_preview({'dir': system('git rev-parse --show-toplevel 2> /dev/null')[:-2]}),
    "     \ <bang>0)
    " command! -bang -nargs=* Rgi
    "     \ call fzf#vim#grep('rg --no-ignore --no-heading --line-number '.shellescape(<q-args>),
    "     \ 1,
    "     \ fzf#vim#with_preview({'dir': system('git rev-parse --show-toplevel 2> /dev/null')[:-2]}),
" \ })<CR>

    command! -bang -nargs=* Rg
        \ call fzf#vim#grep(
        \       'rg --column --line-number --no-heading --color=always '.shellescape(<q-args>), 0,
        \       {'options': '--no-hscroll --delimiter : --nth 4..'},
        \       <bang>0)
    command! -bang -nargs=* Rgi
        \ call fzf#vim#grep(
        \       'rg --column --no-ignore --line-number --no-heading --color=always '.shellescape(<q-args>), 0,
        \       {'options': '--no-hscroll --delimiter : --nth 4..'},
        \       <bang>0)
" floating fzf window with borders
function! CreateCenteredFloatingWindow()
    let width = min([&columns - 4, max([80, &columns - 20])])
    let height = min([&lines - 4, max([20, &lines - 10])])
    let top = ((&lines - height) / 2) - 1
    let left = (&columns - width) / 2
    let opts = {'relative': 'editor', 'row': top, 'col': left, 'width': width, 'height': height, 'style': 'minimal'}

    let top = "╭" . repeat("─", width - 2) . "╮"
    let mid = "│" . repeat(" ", width - 2) . "│"
    let bot = "╰" . repeat("─", width - 2) . "╯"
    let lines = [top] + repeat([mid], height - 2) + [bot]
    let s:buf = nvim_create_buf(v:false, v:true)
    call nvim_buf_set_lines(s:buf, 0, -1, v:true, lines)
    call nvim_open_win(s:buf, v:true, opts)
    set winhl=Normal:Floating
    let opts.row += 1
    let opts.height -= 2
    let opts.col += 2
    let opts.width -= 4
    call nvim_open_win(nvim_create_buf(v:false, v:true), v:true, opts)
    au BufWipeout <buffer> exe 'bw '.s:buf
endfunction

" Files + devicons + floating fzf
function! Fzf_dev()
  let l:fzf_files_options = '--preview-window down --preview "bat --theme="OneHalfDark" --style=numbers,changes --color always {2..-1} | head -'.&lines.'"'
  function! s:files()
    let l:files = split(system($FZF_DEFAULT_COMMAND), '\n')
    return s:prepend_icon(l:files)
  endfunction

  function! s:prepend_icon(candidates)
    let l:result = []
    for l:candidate in a:candidates
      let l:filename = fnamemodify(l:candidate, ':p:t')
      let l:icon = WebDevIconsGetFileTypeSymbol(l:filename, isdirectory(l:filename))
      call add(l:result, printf('%s %s', l:icon, l:candidate))
    endfor

    return l:result
  endfunction

  function! s:edit_file(item)
    let l:pos = stridx(a:item, ' ')
    let l:file_path = a:item[pos+1:-1]
    execute 'silent e' l:file_path
  endfunction

  call fzf#run({
        \ 'source': <sid>files(),
        \ 'sink':   function('s:edit_file'),
        \ 'options': '-m --reverse ' . l:fzf_files_options,
        \ 'down':    '40%',
        \ 'window': 'call CreateCenteredFloatingWindow()'})

    endfunction

Plug 'Konfekt/Fastfold'
    nmap zuz <Plug>(FastFoldUpdate)
    let g:fastfold_savehook = 1
    let g:fastfold_fold_command_suffixes =  ['x','X','a','A','o','O','c','C']
    let g:fastfold_fold_movement_commands = [']z', '[z', 'zj', 'zk']
    let g:markdown_folding = 1
    let g:tex_fold_enabled = 1
    let g:xml_syntax_folding = 2
    let g:javaScript_fold = 2
    let g:sh_fold_enabled= 7
    let g:php_folding = 1
    let g:elixir_folding = 2
    let g:org_folding = 1
"     let g:org_folding = 1
Plug 'AndrewRadev/tagalong.vim'
    let g:tagalong_additional_filetypes = ['phtml', 'twig', 'dhtml']
Plug 'tommcdo/vim-exchange'
Plug 'mattn/emmet-vim'
Plug 'tpope/vim-dadbod'
Plug 'kristijanhusak/vim-dadbod-ui'
Plug 'itchyny/lightline.vim'
    let g:lightline = {
        \   'colorscheme': 'one',
        \   'active': {
        \     'left': [
        \       ['mode', 'paste'],
        \       ['fugitive', 'bufferinfo'],
        \     ],
        \     'right': [
        \       ['colinfo', 'percent'],
        \       ['fileformat', 'filetype'],
        \     ]
        \   },
        \   'inactive': {
        \     'left': [ ['bufferinfo'] ],
        \     'right': [ ['percent'], ['filetype'] ]
        \   },
        \   'tabline': {
        \     'left': [ ['tabs'], ['bufferline'] ],
        \     'right': [ ['fileencoding'] ]
        \   },
        \   'component': {
        \     'bufferinfo': '%<%f %m',
        \     'colinfo': ':%c%V',
        \     'fileencoding': '%{&fenc}',
        \     'readonly': '%{&readonly?"":""}',
        \     'paste': '%{&paste?"PASTE":""}',
        \   },
        \   'component_function': {
        \     'fileformat'  : 'MyFileformat',
        \     'filetype'    : 'MyFiletype',
        \     'fugitive'    : 'MyFugitive'
        \   },
        \   'separator': { 'left': '', 'right': '' },
        \   'subseparator': { 'left': '', 'right': '' },
        \ }

    let g:lightline.enable = {
        \   'statusline': 1,
        \   'tabline': 1
        \ }

    let g:lightline.mode_map = {
        \   'n'      : ' N ',
        \   'i'      : ' I ',
        \   'R'      : ' R ',
        \   'v'      : ' V ',
        \   'V'      : 'V-L',
        \   'c'      : ' C ',
        \   "\<C-v>" : 'V-B',
        \   's'      : ' S ',
        \   'S'      : 'S-L',
        \   "\<C-s>" : 'S-B',
        \   "t"      : ' T ',
        \   '?'      : ' ? '
        \ }

    function! MyFiletype()
    return strlen(&filetype) ? &filetype : '--'
    endfunction

    function! MyFileformat()
    return winwidth('.') > 80 ? &fileformat : ''
    endfunction

    function! MyFugitive()
    if exists('*fugitive#head') && winwidth('.') > 75
        let bmark = '┣ '
        let branch = fugitive#head()
        return strlen(branch) ? bmark . branch : ''
    endif
    return ''
    endfunction
Plug 'troydm/zoomwintab.vim'
Plug 'romainl/vim-qf'
Plug 'AndrewRadev/splitjoin.vim'
    let g:splitjoin_php_method_chain_full = 1
Plug 'moll/vim-bbye'
Plug 'psliwka/vim-smoothie'
"
Plug 'rakr/vim-one'
    let g:one_allow_italics = 1 
Plug 'tpope/vim-fugitive'
" VCS
Plug 'mhinz/vim-signify'


Plug 'rhysd/vim-grammarous', {'on': 'GrammarousCheck'}
"" Check it out again with german language didn't work earlier
    let g:grammarous#use_vim_spelllang = 0
    let g:grammarous#enable_spell_check = 1
    let g:grammarous#use_location_list = 1

" VCS
Plug 'tpope/vim-fugitive'
Plug 'rhysd/git-messenger.vim'
    let g:git_messenger_include_diff = 0
    let g:git_messenger_always_into_popup = v:true

" tagerino vista
" Languages
Plug 'Shougo/echodoc.vim'
    let g:echodoc_enable_at_startup = 1
if exists('g:started_by_firenvim')
else
    Plug 'vim-vdebug/vdebug'
        if !exists('g:vdebug_options')
        let g:vdebug_options = {}
        endif
        let g:vdebug_options.break_on_open = 0
        let g:vdebug_options['max_children'] = 128
        let g:vdebug_options.ide_key = 'PHPSTORM'
    let g:vdebug_options.ide_key = 'PHPSTORM'
Plug 'tpope/vim-obsession'
Plug 'dhruvasagar/vim-prosession'
endif
    let g:prosession_default_session = 0
Plug 'sheerun/vim-polyglot'
    let g:polyglot_disabled = ['latex', 'csv']
Plug 'sgur/vim-editorconfig'
Plug 'andymass/vim-matchup'
" Plug 'lervag/vimtex', {'for': 'tex'}
if has('nvim')
    Plug 'neoclide/coc.nvim', {'branch': 'release'}
    Plug 'neoclide/coc-lists', {'do': 'yarn install --frozen-lockfile'}
    " Plug 'neoclide/coc-snippets', {'do': 'yarn install --frozen-lockfile'}
    Plug 'neoclide/coc-emmet', {'do': 'yarn install --frozen-lockfile'}
    " Plug 'neoclide/coc-highlight', {'do': 'yarn install --frozen-lockfile'}
    " Plug 'neoclide/coc-tsserver', {'do': 'yarn install --frozen-lockfile'}
    Plug 'neoclide/coc-json', {'do': 'yarn install --frozen-lockfile'}
    Plug 'neoclide/coc-yaml', {'do': 'yarn install --frozen-lockfile'}
    Plug 'neoclide/coc-css', {'do': 'yarn install --frozen-lockfile'}
    Plug 'neoclide/coc-html', {'do': 'yarn install --frozen-lockfile'}
    " Plug 'aw3i/coc-phpls', {'do': 'yarn install --frozen-lockfile'}
    " install npm i intelephense -g
endif
Plug 'mechatroner/rainbow_csv'
" Plug 'mechatroner/rainbow_csv'
Plug 'tobyS/pdv', {'for': 'php'} | Plug 'tobyS/vmustache', {'for': 'php'}
    let g:pdv_template_dir = $HOME . "/Documents/git/dotfiles/vim/plugged/pdv/templates_snip"
Plug 'phpactor/phpactor', {'branch': 'develop', 'for': 'php', 'do': 'composer install'}
"     let g:phpactorOmniAutoClassImport = v:true
Plug 'swekaj/php-foldexpr.vim'
    let b:phpfold_text_right_lines = 1
"     let b:phpfold_text_right_lines = 1
Plug 'iamcco/markdown-preview.nvim', { 'do': { -> mkdp#util#install() } }
    let g:mkdp_refresh_slow=1
Plug 'junegunn/limelight.vim'
    autocmd! User GoyoEnter Limelight
    autocmd! User GoyoLeave Limelight!
Plug 'junegunn/goyo.vim'
    let g:mkdp_markdown_css='/usr/local/lib/node_modules/github-markdown-css/github-markdown.css'
Plug 'plasticboy/vim-markdown'
        let g:vim_markdown_fenced_languages = ['c++=cpp', 'viml=vim', 'bash=sh', 'ini=dosini', 'php=php', 'json=json', 'js=javascript', 'css=css', 'less=less', 'html=html']
call plug#end()
" When writing a buffer (no delay).
" When writing a buffer (no delay), and on normal mode changes (after 750ms).
" When writing a buff
call neomake#configure#automake('nw', 750)
" When reading a buffer (after 1s), and when writing (no delay).
call neomake#configure#automake('rw', 1000)
" Full config: when writing or reading a buffer, and on changes in insert and
" normal mode (after 1s; no delay when writing).
call neomake#configure#automake('nrwi', 500)

if (has("termguicolors"))
    set termguicolors
endif
" colorscheme hybrid_reverse
colorscheme one
" if strftime("%H") > 8 && strftime("%H") < 17
"   set background=light
" else
  set background=dark
" endif

nnoremap <silent> <leader>bd :Bdelete<CR>
nnoremap <silent> <leader>bw :Bwipeout<CR>
nnoremap <silent> <leader>tn :tabnew<CR>
" Switch back to normal mode from terminal mode
if has('nvim')
    tnoremap <esc><esc> <C-\><C-n>
    nnoremap  <leader>tv :vs +te<CR>
    nnoremap  <leader>ts :sp +te<CR>
endif

command! -nargs=* Zet call ZettelEdit(<f-args>)
func! ZettelEdit(...)

  " build the file name
  let l:sep = ''
  if len(a:000) > 0
    let l:sep = '-'
  endif
  let l:fname = expand('~/wiki/') . strftime("%F-%H%M") . l:sep . join(a:000, '-') . '.md'

  " edit the new file
  exec "e " . l:fname

  " enter the title and timestamp (using ultisnips) in the new file
  if len(a:000) > 0
    exec "normal ggO\<c-r>=strftime('%Y-%m-%d %H:%M')\<cr> " . join(a:000) . "\<cr>\<esc>G"
  else
    exec "normal ggO\<c-r>=strftime('%Y-%m-%d %H:%M')\<cr>\<cr>\<esc>G"
  endif
endfunc


" Keep search results at the center of screen
nmap n nzz
nmap N Nzz
nmap * *zz
nmap # #zz
nmap g* g*zz
nmap g# g#zz

" Store relative line number jumps in the jumplist.
nnoremap <expr> k (v:count > 1 ? "m'" . v:count : '') . 'k'
nnoremap <expr> j (v:count > 1 ? "m'" . v:count : '') . 'j'

" sneak
"replace 'f' with 1-char Sneak
nmap f <Plug>Sneak_f
nmap F <Plug>Sneak_F
xmap f <Plug>Sneak_f
xmap F <Plug>Sneak_F
omap f <Plug>Sneak_f
omap F <Plug>Sneak_F
"replace 't' with 1-char Sneak
nmap t <Plug>Sneak_t
nmap T <Plug>Sneak_T
xmap t <Plug>Sneak_t
xmap T <Plug>Sneak_T
omap t <Plug>Sneak_t
omap T <Plug>Sneak_T
nmap <leader>lt <Plug>(qf_loc_toggle)
nmap <leader>qt <Plug>(qf_qf_toggle)

" neoterm
xmap <leader>tr <plug>(neoterm-repl-send)
nmap <leader>trl <plug>(neoterm-repl-send-line)

nnoremap <leader>tr :T 
" Rerun last command
nnoremap <silent> <leader>tR :<c-u>exec printf("%sTexec !! \<lt>cr>", v:count)<cr>
nnoremap <silent> <leader>tt :<c-u>exec printf('%sTtoggle', v:count)<cr>
nnoremap <silent> <leader>vt :<c-u>exec printf('botright vertical %s Ttoggle', v:count)<cr>
nnoremap <silent> <leader>te :<c-u>exec printf('%sT exit', v:count)<cr>
nnoremap <silent> <leader>tl :<c-u>exec printf('%sTclear', v:count)<cr>
nnoremap <silent> <leader>tk :<c-u>exec printf('%sTkill', v:count)<cr>

nnoremap <silent> <leader><space> :Files<CR>
nnoremap <silent> <leader><space> :Files<CR>
nnoremap <silent> <leader>a :Buffers<CR>
nnoremap <silent> <leader>; :BLines<CR>
nnoremap <silent> <leader>. :Lines<CR>
" nnoremap <silent> <leader>o :BTags<CR>
nnoremap <silent> <leader>o :Vista finder<CR>
" nnoremap <silent> <leader>O :Tags<CR>
nnoremap <silent> <leader>h :History<CR>
nnoremap <silent> <leader>, :execute 'Rgi ' . input('Rgi/')<CR>
nnoremap <silent> <leader>/ :execute 'Rg ' . input('Rg/')<CR>
nnoremap <silent> <leader>gl :Commits<CR>
nnoremap <silent> <leader>ga :BCommits<CR>
nnoremap <silent> <leader>w :Windows<CR>
inoremap <silent> <C-s> <ESC>:Snippets<CR>
nnoremap <silent> <leader>xm :call FindClass()<CR>
imap <C-x><C-l> <plug>(fzf-complete-line)

" fugitive mappings
function! ToggleGStatus()
    if buflisted(bufname('.git/index'))
        bd .git/index
    else
        Gstatus
    endif
endfunction
function! FindClass()
    :execute "normal! gg/namespace\<cr>w\"nyt;"
    :execute "normal! gg/^class\<cr>w\"cyiw"
    let @n = substitute(@n, '\\', '\\\\', 'g')
    let @n .= '\\' . @c
    :execute 'Rg ' . @n
    let @c = ''
endfunction
command ToggleGStatus :call ToggleGStatus()
nnoremap <leader>ga :Gwrite<CR>
nnoremap <leader>gs :ToggleGStatus<CR>
nnoremap <leader>gd :Gdiff<CR>
nnoremap <leader>gc :Gcommit<CR>
nnoremap <leader>gb :Git branch<Space>

" Others
autocmd FileType php nnoremap <C-p> :call pdv#DocumentWithSnip()<CR>
nnoremap <silent> <F1>  :UndotreeToggle<CR>
nnoremap <silent> <F2>  :Vista!!<CR>
" Edit macro in cmdline window
nnoremap <leader>m  :<c-u><c-r><c-r>='let @'. v:register .' = '. string(getreg(v:register))<cr><c-f><left>
cnoremap <c-n>  <down>
cnoremap <c-p>  <up>
" diff w !diff -au "%" - > changes.patch

" Include use statement
autocmd FileType php nmap <Leader>u :call phpactor#UseAdd()<CR>
" Invoke the context menu
autocmd FileType php nmap <Leader>mm :call phpactor#ContextMenu()<CR>
" Goto definition of class or class member under the cursor
autocmd FileType php nmap <Leader>oo :call phpactor#GotoDefinition()<CR>
autocmd FileType php nmap <Leader>oh :call phpactor#GotoDefinitionHsplit()<CR>
autocmd FileType php nmap <Leader>ov :call phpactor#GotoDefinitionVsplit()<CR>
autocmd FileType php nmap <Leader>ot :call phpactor#GotoDefinitionTab()<CR>
autocmd FileType php nmap <Leader>na :call phpactor#Navigate()<CR>
" Transform the classes in the current file
autocmd FileType php nmap <Leader>pt :call phpactor#Transform()<CR>
" Display information
autocmd FileType php nmap <Leader>h :call phpactor#Hover()<CR>
" Generate a new class (replacing the current file)
autocmd FileType php nmap <Leader>cc :call phpactor#ClassNew()<CR>
" Extract expressoins
autocmd FileType php nmap <Leader>ee :call phpactor#ExtractExpression(v:false)<CR>
autocmd FileType php vmap <silent><Leader>em :<C-U>call phpactor#ExtractExpression(v:true)<CR>
"Extract interface
autocmd FileType php nmap <Leader>ei :call phpactor#ClassInflect()<CR>
autocmd FileType php nmap <Leader>fr :call phpactor#FindReferences()<CR>
" Extract method from selection
autocmd FileType php vmap <silent><Leader>em :<C-U>call phpactor#ExtractMethod()<CR>
" Ale
nmap <silent> <C-k> <Plug>(ale_previous_wrap)
nmap <silent> <C-j> <Plug>(ale_next_wrap)
autocmd BufNewFile,BufRead *.csv set nowrap

function! PhpSyntaxOverride()
  hi! def link phpDocTags  phpDefine
  hi! def link phpDocParam phpType
endfunction

augroup phpSyntaxOverride
  autocmd!
  autocmd FileType php call PhpSyntaxOverride()
augroup END
autocmd BufWritePost *.exs,*.ex silent :!mix format %
autocmd BufNewFile,BufRead *.phtml setf php
autocmd BufNewFile,BufRead *.dhtml setf php
autocmd FileType mail set spell
"Coc test

" Use <cr> to confirm completion, `<C-g>u` means break undo chain at current position.
" Coc only does snippet and additional edit on confirm.
inoremap <expr> <cr> pumvisible() ? "\<C-y>" : "\<C-g>u\<CR>"
" Or use `complete_info` if your vim support it, like:
" inoremap <expr> <cr> complete_info()["selected"] != "-1" ? "\<C-y>" : "\<C-g>u\<CR>"

" Use `[g` and `]g` to navigate diagnostics
nmap <silent> [g <Plug>(coc-diagnostic-prev)
nmap <silent> ]g <Plug>(coc-diagnostic-next)

" Remap keys for gotos
nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gy <Plug>(coc-type-definition)
nmap <silent> gi <Plug>(coc-implementation)
nmap <silent> gr <Plug>(coc-references)

" Use K to show documentation in preview window
nnoremap <silent> K :call <SID>show_documentation()<CR>

function! s:show_documentation()
  if (index(['vim','help'], &filetype) >= 0)
    execute 'h '.expand('<cword>')
  else
    call CocAction('doHover')
  endif
endfunction

" Highlight symbol under cursor on CursorHold
autocmd CursorHold * silent call CocActionAsync('highlight')

" Remap for rename current word
nmap <leader>rn <Plug>(coc-rename)

" Remap for format selected region
xmap <leader>f  <Plug>(coc-format-selected)
nmap <leader>f  <Plug>(coc-format-selected)

augroup mygroup
  autocmd!
  " Setup formatexpr specified filetype(s).
  autocmd FileType typescript,json setl formatexpr=CocAction('formatSelected')
  " Update signature help on jump placeholder
  autocmd User CocJumpPlaceholder call CocActionAsync('showSignatureHelp')
augroup end

" Remap for do codeAction of selected region, ex: `<leader>aap` for current paragraph
" xmap <leader>a  <Plug>(coc-codeaction-selected)
" nmap <leader>a  <Plug>(coc-codeaction-selected)

" Remap for do codeAction of current line
nmap <leader>Ac  <Plug>(coc-codeaction)
" Fix autofix problem of current line
nmap <leader>qf  <Plug>(coc-fix-current)

" Create mappings for function text object, requires document symbols feature of languageserver.
xmap if <Plug>(coc-funcobj-i)
xmap af <Plug>(coc-funcobj-a)
omap if <Plug>(coc-funcobj-i)
omap af <Plug>(coc-funcobj-a)

" Use <C-d> for select selections ranges, needs server support, like: coc-tsserver, coc-python
" nmap <silent> <C-d> <Plug>(coc-range-select)
" xmap <silent> <C-d> <Plug>(coc-range-select)

" Use `:Format` to format current buffer
command! -nargs=0 Format :call CocAction('format')

" Use `:Fold` to fold current buffer
command! -nargs=? Fold :call     CocAction('fold', <f-args>)

" use `:OR` for organize import of current buffer
command! -nargs=0 OR   :call     CocAction('runCommand', 'editor.action.organizeImport')

" Add status line support, for integration with other plugin, checkout `:h coc-status`
set statusline^=%{coc#status()}%{get(b:,'coc_current_function','')}

" Using CocList
" Show all diagnostics
" nnoremap <silent> <space>a  :<C-u>CocList diagnostics<cr>
nnoremap <silent> <space>e  :<C-u>CocList extensions<cr>
nnoremap <silent> <leader>e  :<C-u>CocList extensions<cr>
nnoremap <silent> <space>c  :<C-u>CocList commands<cr>
nnoremap <silent> <leader>c  :<C-u>CocList commands<cr>
nnoremap <silent> <space>o  :<C-u>CocList outline<cr>
nnoremap <silent> <leader>o  :<C-u>CocList outline<cr>
nnoremap <silent> <space>s  :<C-u>CocList -I symbols<cr>
nnoremap <silent> <leader>s  :<C-u>CocList -I symbols<cr>
nnoremap <silent> <space>j  :<C-u>CocNext<CR>
nnoremap <silent> <leader>j  :<C-u>CocNext<CR>
nnoremap <silent> <space>k  :<C-u>CocPrev<CR>
nnoremap <silent> <leader>k  :<C-u>CocPrev<CR>
nnoremap <silent> <space>p  :<C-u>CocListResume<CR>
